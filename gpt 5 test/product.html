<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Product Details - My Crochet Boutique</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&family=Great+Vibes&display=swap" rel="stylesheet">

    <style>
        /* ========================================= */
        /* --- 1. GLOBAL & HEADER STYLES --- */
        /* ========================================= */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html { scroll-behavior: smooth; }
        body {
            margin: 0; padding: 0; width: 100%; overflow-x: hidden; 
            font-family: 'Poppins', sans-serif; -webkit-font-smoothing: antialiased;
            padding-top: 70px; /* Space for fixed header */
            background-color: #ffffff; color: #333;
        }
        :root { --primary: #ff8fa3; }
        input, textarea, button, select { font-size: 16px !important; font-family: 'Poppins', sans-serif; }

        /* HEADER */
        header {
            background: linear-gradient(135deg, #ff9a9e 0%, #ff8fa3 100%);
            color: white; height: 70px; padding: 0 15px;
            display: flex; align-items: center; justify-content: space-between;
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            box-shadow: 0 4px 15px rgba(255, 143, 163, 0.3);
        }
        .header-left, .header-right { display: flex; align-items: center; gap: 10px; }
        .icon-btn { background: transparent; border: none; color: white; font-size: 20px; cursor: pointer; padding: 5px; display: flex; align-items: center; justify-content: center; text-decoration: none; }
        .logo { font-size: 24px; font-family: 'Great Vibes', cursive; color: white; text-decoration: none; display: flex; align-items: center; }
        .logo-img { height: 50px; width: auto; object-fit: contain; }
        
        .cart-btn { position: relative; }
        .cart-badge { position: absolute; top: -5px; right: -8px; background: white; color: var(--primary); font-size: 10px; font-weight: bold; width: 16px; height: 16px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        /* ========================================= */
        /* --- 2. PRODUCT SPECIFIC CSS --- */
        /* ========================================= */

        /* --- FIXED ZIGZAG VOUCHER BANNER --- */
        .voucher-wrapper {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-top: 10px; 
            padding: 20px 15px 0 15px; 
            box-sizing: border-box;
            overflow: visible; 
        }

        .voucher-ticket {
            position: relative;
            background: #fff0f3;
            color: #333;
            border-top: 2px dashed #ff8fa3;
            border-bottom: 2px dashed #ff8fa3;
            padding: 12px 25px;
            width: calc(100% - 20px); 
            max-width: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 14px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            flex-wrap: wrap; 
            margin: 0 auto; 
        }

        /* Zigzag Pattern Logic */
        .voucher-ticket::before, 
        .voucher-ticket::after {
            content: "";
            position: absolute;
            top: 0; bottom: 0; 
            width: 12px; 
            background-size: 12px 24px; 
            background-repeat: repeat-y;
            z-index: 1; 
        }

        .voucher-ticket::before { 
            left: -12px; 
            background-image: linear-gradient(135deg, #fff0f3 50%, transparent 50%), 
                              linear-gradient(45deg, #fff0f3 50%, transparent 50%);
        }

        .voucher-ticket::after { 
            right: -12px; 
            background-image: linear-gradient(-135deg, #fff0f3 50%, transparent 50%), 
                              linear-gradient(-45deg, #fff0f3 50%, transparent 50%);
        }

        .voucher-icon { color: #ff8fa3; font-size: 18px; transform: rotate(-10deg); }
        .coupon-code {
            background: white; padding: 4px 10px; border: 1px solid #ff8fa3;
            color: #ff8fa3; font-weight: 800; border-radius: 4px; cursor: pointer; white-space: nowrap; margin-left: 5px;
        }
        .coupon-code:hover { background: #ff8fa3; color: white; }

        /* --- PRODUCT PAGE LAYOUT --- */
        .pd-container {
            max-width: 1200px; width: 95%; margin: 30px auto;
            display: grid; grid-template-columns: 1.2fr 1fr; gap: 40px; align-items: start;
        }

        .pd-images { display: flex; flex-direction: column; gap: 15px; }
        .main-image-frame {
            border-radius: 20px; overflow: hidden; background: #fafafa;
            aspect-ratio: 1/1; max-height: 500px; width: 100%;
        }
        .main-image-frame img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
        .main-image-frame:hover img { transform: scale(1.05); }

        .thumbnail-track { 
            display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; 
            -webkit-overflow-scrolling: touch; scrollbar-width: none;
        }
        .thumbnail-track::-webkit-scrollbar { display: none; }
        .thumb {
            width: 70px; height: 70px; border-radius: 12px; object-fit: cover;
            cursor: pointer; border: 2px solid transparent; opacity: 0.6; flex-shrink: 0;
        }
        .thumb.active { border-color: #ff8fa3; opacity: 1; }

        .pd-info { padding: 10px 0; }
        .handmade-badges { display: flex; gap: 10px; margin-bottom: 15px; }
        .badge {
            background: #fff0f3; color: #ff8fa3; font-size: 12px; font-weight: 600;
            padding: 5px 12px; border-radius: 20px; display: inline-flex; align-items: center; gap: 5px;
        }
        .pd-title { font-size: 36px; font-weight: 700; margin: 0 0 10px 0; line-height: 1.2; }
        .pd-meta { display: flex; flex-wrap: wrap; align-items: center; gap: 20px; margin-bottom: 20px; }
        .pd-price { font-size: 26px; font-weight: 600; color: #ff8fa3; }
        .processing-time { font-size: 13px; color: #666; background: #f9f9f9; padding: 5px 10px; border-radius: 5px; }

        .description-box {
            background-color: #f9fafb; border: 1px solid #eee; border-radius: 15px; padding: 20px; margin-bottom: 25px;
            height: auto; width: 100%; overflow: visible;
        }
        .description-box .pd-subtitle {
            margin-top: 0; font-size: 18px; font-weight: 600; color: #333; font-style: italic; margin-bottom: 10px;
        }
        .description-box .pd-short-desc { font-size: 15px; color: #555; line-height: 1.6; margin: 0; }

        .selector-group { margin-bottom: 20px; }
        .selector-label { display: flex; justify-content: space-between; font-weight: 600; font-size: 14px; margin-bottom: 8px; }
        .size-options { display: flex; gap: 10px; }
        .size-btn { background: white; border: 1px solid #ddd; padding: 8px 15px; border-radius: 8px; font-size: 14px; cursor: pointer; }
        .size-btn.active { border-color: #333; background: #333; color: white; }

        .pd-actions-sticky { display: flex; gap: 15px; margin-bottom: 30px; align-items: center; }
        .quantity-selector { display: flex; align-items: center; border: 1px solid #ddd; border-radius: 30px; padding: 5px; height: 45px; }
        .quantity-selector button { background: none; border: none; width: 30px; font-size: 18px; cursor: pointer; }
        .quantity-selector input { width: 30px; text-align: center; border: none; font-weight: bold; outline: none; }
        .pd-btn-group { flex: 1; display: flex; gap: 10px; height: 50px; }
        .pd-add-btn, .pd-buy-btn { flex: 1; border-radius: 30px; font-size: 15px; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .pd-add-btn { background: white; border: 1px solid #333; color: #333; }
        .pd-add-btn:hover { background: #f0f0f0; }
        .pd-buy-btn { background: #333; border: 1px solid #333; color: white; }
        .pd-buy-btn:hover { opacity: 0.9; }

        .pd-details-list { display: flex; flex-direction: column; gap: 15px; }
        .detail-item h3 { font-size: 14px; font-weight: 700; margin: 0 0 5px 0; display: flex; align-items: center; gap: 8px; }
        .detail-item p { font-size: 13px; color: #666; margin: 0; }

        /* --- RECOMMENDATION & TRUST BANNER --- */
        .recommendation-wrapper { max-width: 1200px; width: 95%; margin: 60px auto 20px auto; border-top: 1px solid #eee; padding-top: 50px; }
        .rec-title { text-align: center; font-size: 28px; font-weight: 700; margin-bottom: 30px; }
        .product-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .product-card { background: white; padding: 10px; text-align: center; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); overflow: hidden; border: 2px solid transparent; transition: all 0.2s ease; cursor: pointer; }
        .product-card img { width: 100%; height: 160px; object-fit: contain; border-radius: 20px; }
        .product-card:hover { transform: translateY(-5px); }
        .product-info h3 { font-size: 14px; margin: 10px 0 5px; }
        .product-info .price { font-weight: bold; color: var(--primary); margin: 0 0 10px; }
        .btn-add { width: 100%; padding: 8px; border-radius: 20px; background: black; color: white; border: none; cursor: pointer; }

        .trust-banner-section { background: #fdfdfd; border-top: 1px solid #eee; padding: 30px 0; margin-top: 40px; }
        .trust-banner-container { max-width: 1000px; width: 95%; margin: 0 auto; display: flex; align-items: center; gap: 40px; }
        .trust-content { flex: 1.2; }
        .trust-image-wrapper { flex: 0.8; height: 220px; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        .trust-image-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .trust-grid { display: flex; flex-direction: column; gap: 15px; }
        .trust-item { display: flex; align-items: center; gap: 15px; }
        .trust-item i { color: #ff8fa3; font-size: 18px; background: #fff0f3; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 50%; flex-shrink: 0; }
        .trust-item .text strong { display: block; font-size: 14px; }
        .trust-item .text p { margin: 0; font-size: 12px; color: #666; }

        /* --- FOOTER STYLES --- */
        .main-footer { background-color: #222; color: #ddd; padding: 60px 0 20px 0; margin-top: 60px; font-size: 14px; }
        .footer-container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1.5fr 1fr 1fr 1.2fr; gap: 30px; padding: 0 20px; }
        .footer-col h4 { color: white; margin-bottom: 20px; font-size: 16px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .footer-logo { font-family: 'Great Vibes', cursive; font-size: 32px; color: white; text-decoration: none; display: block; margin-bottom: 10px; }
        .brand-desc { line-height: 1.6; margin-bottom: 20px; opacity: 0.8; }
        .footer-socials { display: flex; gap: 15px; }
        .footer-socials a { color: white; background: rgba(255,255,255,0.1); width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: 0.3s; }
        .footer-links { list-style: none; padding: 0; }
        .footer-links li { margin-bottom: 10px; }
        .footer-links a { color: #ddd; text-decoration: none; transition: 0.3s; }
        .newsletter-form { display: flex; background: rgba(255,255,255,0.1); border-radius: 50px; overflow: hidden; }
        .newsletter-form input { background: transparent; border: none; padding: 10px 15px; color: white; width: 100%; outline: none; }
        .newsletter-form button { background: var(--primary); border: none; color: white; padding: 0 20px; cursor: pointer; }
        .footer-bottom { border-top: 1px solid rgba(255,255,255,0.1); margin-top: 40px; padding-top: 20px; text-align: center; }

        /* Toast */
        .toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 25px; padding: 16px; position: fixed; z-index: 2000; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 14px; opacity: 0; transition: opacity 0.5s, bottom 0.5s; }
        .toast.show { visibility: visible; opacity: 1; bottom: 50px; }

        /* ========================================= */
        /* --- MEDIA QUERIES (TABLET & MOBILE) --- */
        /* ========================================= */
        @media (max-width: 1024px) {
            .pd-container { gap: 20px; }
            .pd-title { font-size: 30px; }
            .product-grid { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 768px) {
            /* Mobile Voucher Spacing */
            .voucher-wrapper { margin-top: 20px; padding-top: 10px; }
            .voucher-ticket { font-size: 11px; padding: 6px 20px; gap: 5px; width: 90%; }
            .voucher-icon { font-size: 13px; }
            .coupon-code { font-size: 10px; padding: 2px 6px; }

            /* Product Layout */
            .pd-container { display: block; width: 100%; padding: 0 15px; margin: 15px 0; }
            .pd-info { margin-top: 15px; }

            /* Edge-to-Edge Image on Mobile */
            .main-image-frame { border-radius: 0 0 25px 25px; margin: 0 -15px; width: calc(100% + 30px); aspect-ratio: 4/3; max-height: 350px; }
            
            .pd-title { font-size: 24px; }
            .description-box { padding: 15px; }

            /* Sticky Bottom Actions */
            .pd-actions-sticky {
                position: fixed; bottom: 0; left: 0; width: 100%;
                background: white; padding: 10px 15px;
                padding-bottom: calc(10px + env(safe-area-inset-bottom)); 
                box-shadow: 0 -4px 15px rgba(0,0,0,0.05); z-index: 9999; margin: 0;
            }
            .quantity-selector { display: none; } 
            .pd-btn-group { width: 100%; }
            
            /* Footer */
            .main-footer { padding-bottom: 90px !important; }
            .footer-container { grid-template-columns: 1fr; text-align: center; gap: 40px; }
            .footer-socials { justify-content: center; }

            /* Grids & Banners */
            .product-grid { grid-template-columns: repeat(2, 1fr) !important; gap: 10px; }
            .recommendation-wrapper .product-card img { height: 140px; }
            .recommendation-wrapper .product-card h3 { font-size: 12px; margin: 5px 0; }
            .trust-banner-container { flex-direction: column-reverse; gap: 20px; }
            .trust-image-wrapper { width: 100%; height: 160px; }
            .trust-content h2 { font-size: 20px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-left">
            <a href="index.html" class="icon-btn"><i class="fa-solid fa-arrow-left"></i></a> 
            <a href="index.html" class="logo">
                <img src="Untitled_design-removebg-preview.png" onerror="this.src='https://placehold.co/100x50/ff8fa3/white?text=HKC'" alt="Handcraft Kindness Creation" class="logo-img">
            </a>
        </div>
        <div class="header-right">
            <a href="cart.html" class="icon-btn cart-btn">
                <i class="fa-solid fa-cart-shopping"></i><span id="cart-count" class="cart-badge">0</span>
            </a>
        </div>
    </header>

    <div class="voucher-wrapper">
        <div class="voucher-ticket">
            <span class="voucher-icon"><i class="fa-solid fa-ticket"></i></span>
            <span class="voucher-text">
                Shop now & get <strong>20% Off</strong>! Code:
            </span>
            <span class="coupon-code" onclick="copyCoupon(this)">CROCHET20</span>
        </div>
    </div>

    <div class="pd-container">
        
        <div class="pd-images">
            <div class="main-image-frame">
                <!-- IMPORTANT: Default image can be anything, JS will replace it -->
                <img id="mainImage" src="https://placehold.co/600x600?text=Loading..." alt="Product Image">
            </div>
            
            <!-- Updated: Removed static images, added ID for JS targeting -->
            <div class="thumbnail-track" id="thumbnailTrack">
                <!-- Javascript will inject images here -->
            </div>
        </div>

        <div class="pd-info">
            
            <div class="handmade-badges">
                <span class="badge"><i class="fa-solid fa-hand-sparkles"></i> 100% Handmade</span>
                <span class="badge"><i class="fa-solid fa-leaf"></i> Organic Yarn</span>
            </div>

            <!-- IMPORTANT: Added ID="dynamic-title" so JS can change text -->
            <h1 class="pd-title" id="dynamic-title">Loading...</h1>
            
            <div class="pd-meta">
                <!-- IMPORTANT: Added ID="dynamic-price" so JS can change text -->
                <span class="pd-price" id="dynamic-price">...</span>
                <div class="processing-time">
                    <i class="fa-regular fa-clock"></i> Made to order: <strong>5-7 Days</strong>
                </div>
            </div>

            <div class="description-box">
                <h2 class="pd-subtitle">Handcrafted with Passion & Care ðŸ§¶âœ¨</h2>
                <p class="pd-short-desc" id="dynamic-desc">
                   Loading product details...
                </p>
            </div>

            <div class="pd-actions-sticky">
                <div class="quantity-selector">
                    <button onclick="decreaseQty()">-</button>
                    <input type="text" id="qtyInput" value="1" readonly>
                    <button onclick="increaseQty()">+</button>
                </div>
                <div class="pd-btn-group">
                    <button class="pd-add-btn" id="addToBagBtn">Add to Bag</button>
                    <button class="pd-buy-btn" id="buyNowBtn">Buy Now</button>
                </div>
            </div>

            <div class="pd-details-list">
                <div class="detail-item">
                    <h3><i class="fa-solid fa-scroll"></i> Yarn Details</h3>
                    <p>60% Cotton, 40% Acrylic blend. Soft, durable, and retains shape after washing.</p>
                </div>
                <div class="detail-item">
                    <h3><i class="fa-solid fa-soap"></i> Care Instructions</h3>
                    <p>Hand wash in cold water using mild detergent. Lay flat to dry.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Recommendations (Same as before) -->
    <div class="recommendation-wrapper">
        <h2 class="rec-title">You Might Also Love ðŸ’–</h2>
        <div class="product-grid">
            <div class="product-card" data-title="Floral Crochet Top" onclick="viewProduct(this)">
                <img src="https://images.unsplash.com/photo-1620799140408-ed5341cd2431?auto=format&fit=crop&w=600&q=80" alt="Floral Top">
                <div class="product-info"><h3>Floral Crochet Top</h3><p class="price">$45.00</p><button class="btn-add" onclick="event.stopPropagation(); viewProduct(this.parentElement.parentElement)">View</button></div>
            </div>
            <div class="product-card" data-title="Boho Sun Bag" onclick="viewProduct(this)">
                <img src="https://images.unsplash.com/photo-1590835805566-4f7f5255c4d6?auto=format&fit=crop&w=600&q=80" alt="Boho Bag">
                <div class="product-info"><h3>Boho Sun Bag</h3><p class="price">$35.00</p><button class="btn-add" onclick="event.stopPropagation(); viewProduct(this.parentElement.parentElement)">View</button></div>
            </div>
            <div class="product-card" data-title="Cozy Wool Hat" onclick="viewProduct(this)">
                <img src="https://images.unsplash.com/photo-1576871337632-b9aef4c17ab9?auto=format&fit=crop&w=600&q=80" alt="Wool Hat">
                <div class="product-info"><h3>Cozy Wool Hat</h3><p class="price">$18.00</p><button class="btn-add" onclick="event.stopPropagation(); viewProduct(this.parentElement.parentElement)">View</button></div>
            </div>
            <div class="product-card" data-title="Amigurumi Bunny" onclick="viewProduct(this)">
                <img src="https://images.unsplash.com/photo-1616428359740-42f155694c36?auto=format&fit=crop&w=600&q=80" alt="Bunny Toy">
                <div class="product-info"><h3>Amigurumi Bunny</h3><p class="price">$25.00</p><button class="btn-add" onclick="event.stopPropagation(); viewProduct(this.parentElement.parentElement)">View</button></div>
            </div>
        </div>
    </div>

    <section class="trust-banner-section">
        <div class="trust-banner-container">
            <div class="trust-content">
                <h2>Why Choose Handmade? ðŸ§¶</h2>
                <div class="trust-grid">
                    <div class="trust-item">
                        <i class="fa-solid fa-hand-holding-heart"></i>
                        <div class="text"><strong>Made with Love</strong><p>Every stitch is placed by hand.</p></div>
                    </div>
                    <div class="trust-item">
                        <i class="fa-solid fa-leaf"></i>
                        <div class="text"><strong>Eco-Friendly</strong><p>Premium organic cotton yarn.</p></div>
                    </div>
                    <div class="trust-item">
                        <i class="fa-solid fa-check-circle"></i>
                        <div class="text"><strong>Quality Checked</strong><p>Inspected for perfection.</p></div>
                    </div>
                </div>
            </div>
            <div class="trust-image-wrapper">
                <img src="https://images.unsplash.com/photo-1533090161767-e6ffed986c88?auto=format&fit=crop&w=800&q=80" alt="Vibrant Colorful Yarn">
            </div>
        </div>
    </section>
    
    <footer class="main-footer">
        <div class="footer-container">
            <div class="footer-col brand-col">
                <a href="#" class="footer-logo">MyCrochet</a>
                <p class="brand-desc">Handcrafted with premium yarn, sustainability, and endless love. Making the world softer, one stitch at a time.</p>
                <div class="footer-socials">
                    <a href="#"><i class="fa-brands fa-instagram"></i></a>
                    <a href="#"><i class="fa-brands fa-facebook-f"></i></a>
                </div>
            </div>
            <div class="footer-col">
                <h4>Shop</h4>
                <ul class="footer-links">
                    <li><a href="#">Best Sales</a></li>
                    <li><a href="#">Custom Orders</a></li>
                    <li><a href="#">Accessories</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Customer Care</h4>
                <ul class="footer-links">
                    <li><a href="#">Shipping Policy</a></li>
                    <li><a href="#">Returns & Exchanges</a></li>
                    <li><a href="#">Crochet Care Guide</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Stay in the Loop</h4>
                <p class="newsletter-text">Subscribe for exclusive patterns & drops.</p>
                <form class="newsletter-form">
                    <input type="email" placeholder="Your email address" required>
                    <button type="submit"><i class="fa-solid fa-paper-plane"></i></button>
                </form>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 MyCrochet Boutique. All rights reserved.</p>
        </div>
    </footer>

    <div id="toast" class="toast">Added to cart!</div>

    <script>
        /**
         * product.html dynamic population script
         * - will update main image, thumbnails, title, price & description using:
         * 1) ?id=... param which matches an entry in the `products` array below, OR
         * 2) fallback to URL params: title, price, img, desc, images (comma separated)
         *
         * This script keeps your existing design unchanged.
         */

        // --- Demo products array (you can expand or load from external file) ---
        const products = [
            {
                id: "1",
                name: "Happy Taddy",
                price: "1000",
                description: "Hand-stitched taddy crafted with love. Perfect as a gift and soft to touch.",
                mainImage: "all photo/Gemini_Generated_Image_oixgmjoixgmjoixg.png",
                gallery: [
                  "all photo/Gemini_Generated_Image_oixgmjoixgmjoixg.png",
                  "https://placehold.co/800x600?text=Happy+Taddy+2",
                  "https://placehold.co/800x600?text=Happy+Taddy+3"
                ]
            },
            {
                id: "2",
                name: "Blue Bag",
                price: "200",
                description: "Lightweight boho bag â€” ideal for summer outings.",
                mainImage: "all photo/Gemini_Generated_Image_iy33wjiy33wjiy33.png",
                gallery: [
                  "all photo/Gemini_Generated_Image_iy33wjiy33wjiy33.png",
                  "https://images.unsplash.com/photo-1584917865442-de89df76afd3?auto=format&fit=crop&w=1000&q=80",
                  "https://images.unsplash.com/photo-1594223274512-ad4803739b7c?auto=format&fit=crop&w=1000&q=80"
                ]
            },
            {
                id: "3",
                name: "Fantastic Puppy",
                price: "1500",
                description: "Soft puppy toy made from premium materials.",
                mainImage: "all photo/Gemini_Generated_Image_mya860mya860mya8.png",
                gallery: [
                  "all photo/Gemini_Generated_Image_mya860mya860mya8.png",
                  "https://placehold.co/800x600?text=Fantastic+Puppy+2"
                ]
            },
            {
                id: "4",
                name: "Small Taddy",
                price: "500",
                description: "A smaller version of our signature taddy.",
                mainImage: "all photo/Gemini_Generated_Image_vu8ufgvu8ufgvu8u.png",
                gallery: [
                  "all photo/Gemini_Generated_Image_vu8ufgvu8ufgvu8u.png"
                ]
            }
        ];

        const CART_KEY = 'myCrochetCart';

        // Utility: format price (adds currency if missing)
        function formatPrice(raw) {
            if (raw === undefined || raw === null || raw === '') return 'â€”';
            const s = String(raw).trim();
            if (s.match(/[â‚¹$â‚¬Â£]/)) return s;
            // if value is numeric, prefix with â‚¹
            if (/^[0-9.,]+$/.test(s)) return 'â‚¹' + s;
            return s;
        }

        // Update cart badge from localStorage
        function updateCartBadge() {
            try {
                const cart = JSON.parse(localStorage.getItem(CART_KEY)) || [];
                const count = cart.reduce((sum, i) => sum + (i.qty || 0), 0);
                const badge = document.getElementById('cart-count');
                if (badge) badge.innerText = count;
            } catch (e) {
                // ignore
            }
        }

        // Build thumbnails
        function buildThumbnails(images, startIndex = 0) {
            const track = document.getElementById('thumbnailTrack');
            const main = document.getElementById('mainImage');
            if (!track || !main) return;
            track.innerHTML = '';
            images.forEach((src, idx) => {
                const img = document.createElement('img');
                img.src = src;
                img.alt = `View ${idx + 1}`;
                img.className = (idx === startIndex) ? 'thumb active' : 'thumb';
                img.onclick = function () {
                    // set main image (attempt to use higher-res if URL param style)
                    const high = src.replace('&w=200', '&w=1000');
                    main.src = high;
                    // toggle active
                    document.querySelectorAll('.thumb').forEach(t => t.classList.remove('active'));
                    img.classList.add('active');
                };
                img.onerror = function () { this.src = 'https://placehold.co/200x200?text=No+Image'; };
                track.appendChild(img);
            });
        }

        // parse images param comma separated
        function parseImagesParam(param, mainImg) {
            if (!param) return mainImg ? [mainImg] : [];
            const arr = param.split(',').map(s => s.trim()).filter(Boolean);
            if (arr.length === 0 && mainImg) arr.push(mainImg);
            return arr;
        }

        // Change quantity
        function increaseQty() {
            const input = document.getElementById('qtyInput');
            let v = parseInt(input.value || '1', 10);
            if (v < 10) input.value = v + 1;
        }
        function decreaseQty() {
            const input = document.getElementById('qtyInput');
            let v = parseInt(input.value || '1', 10);
            if (v > 1) input.value = v - 1;
        }

        // Add to cart
        function addToCartAction(productData) {
            const qty = parseInt(document.getElementById('qtyInput').value || '1', 10);
            const cart = JSON.parse(localStorage.getItem(CART_KEY)) || [];

            // Try to find existing cart item by id if present, else by title
            let existing = null;
            if (productData.id) existing = cart.find(i => i.id && String(i.id) === String(productData.id));
            if (!existing) existing = cart.find(i => i.title === productData.title);

            if (existing) {
                existing.qty = (existing.qty || 0) + qty;
            } else {
                cart.push({
                    id: productData.id || null,
                    title: productData.title,
                    price: productData.price,
                    img: (productData.images && productData.images[0]) || productData.mainImage || document.getElementById('mainImage').src,
                    qty: qty
                });
            }

            localStorage.setItem(CART_KEY, JSON.stringify(cart));
            updateCartBadge();
            showToast('Added to cart!');
        }

        // Show toast
        function showToast(msg = 'Added to cart!') {
            const toast = document.getElementById('toast');
            if (!toast) return;
            toast.innerText = msg;
            toast.className = 'toast show';
            setTimeout(() => { toast.className = toast.className.replace('show', ''); }, 3000);
        }

        // Buy now
        function buyNowAction(productData) {
            addToCartAction(productData);
            // For demo: go to cart page
            setTimeout(() => { window.location.href = 'cart.html'; }, 400);
        }

        // Copy coupon
        function copyCoupon(el) {
            const code = el.innerText || el.textContent;
            const tmp = document.createElement('input');
            tmp.value = code;
            document.body.appendChild(tmp);
            tmp.select();
            try {
                document.execCommand('copy');
                showToast('Coupon copied: ' + code);
            } catch (e) {
                alert('Copied: ' + code);
            }
            document.body.removeChild(tmp);
        }

        // If user clicks recommendations: try to find matching product in products[] by name and navigate with id,
        // otherwise navigate with title param.
        function viewProduct(elem) {
            const title = (elem.querySelector && elem.querySelector('.product-info h3')) ? elem.querySelector('.product-info h3').innerText : (elem.dataset && elem.dataset.title) || '';
            if (!title) { window.location.reload(); return; }
            const match = products.find(p => (p.name || '').toLowerCase() === title.toLowerCase());
            if (match) {
                window.location.href = 'product.html?id=' + encodeURIComponent(match.id);
            } else {
                // fallback: pass title param
                window.location.href = 'product.html?title=' + encodeURIComponent(title);
            }
        }

        // Main population logic (keeps design unchanged)
        document.addEventListener('DOMContentLoaded', function () {
            updateCartBadge();

            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            const titleParam = params.get('title');
            const priceParam = params.get('price');
            const imgParam = params.get('img');
            const descParam = params.get('desc');
            const imagesParam = params.get('images'); // comma separated

            let productData = null;

            // 1) Try id match in products[]
            if (id) {
                productData = products.find(p => String(p.id) === String(id) || String(p.id) === String(Number(id)));
            }

            // 2) Fallback to title param or other params
            if (!productData && (titleParam || imgParam || priceParam || descParam || imagesParam)) {
                const imgs = parseImagesParam(imagesParam, imgParam);
                productData = {
                    id: null,
                    title: titleParam || 'Product',
                    price: priceParam || '',
                    description: descParam || '',
                    images: imgs.length ? imgs : (imgParam ? [imgParam] : [])
                };
            }

            // 3) If still no data, use the first product as default (graceful)
            if (!productData && products.length > 0) {
                productData = products[0];
            }

            // Ensure structure
            if (!productData) {
                // nothing to show
                document.getElementById('dynamic-title').innerText = 'Product not found';
                document.getElementById('dynamic-price').innerText = 'â€”';
                document.getElementById('dynamic-desc').innerText = 'We could not find this product.';
                return;
            }

            // Normalize to fields used by the template
            const normalized = {
                id: productData.id || null,
                title: productData.name || productData.title || productData.title || '',
                price: productData.price || productData.price || productData.price || '',
                desc: productData.description || productData.desc || productData.desc || productData.description || '',
                mainImage: productData.mainImage || (productData.images && productData.images[0]) || imgParam || '',
                images: (productData.gallery && productData.gallery.length) ? productData.gallery.slice() : ((productData.images && productData.images.length) ? productData.images.slice() : parseImagesParam(imagesParam, imgParam))
            };

            // If mainImage exists and not first in images[], put it first
            if (normalized.mainImage && Array.isArray(normalized.images)) {
                normalized.images = [normalized.mainImage].concat(normalized.images.filter(i => i !== normalized.mainImage));
            } else if (normalized.mainImage && (!Array.isArray(normalized.images) || normalized.images.length === 0)) {
                normalized.images = [normalized.mainImage];
            }

            // Populate DOM
            const titleEl = document.getElementById('dynamic-title');
            const priceEl = document.getElementById('dynamic-price');
            const descEl = document.getElementById('dynamic-desc');
            const mainImgEl = document.getElementById('mainImage');

            if (titleEl) {
                titleEl.innerText = normalized.title || 'Product';
                document.title = normalized.title ? (normalized.title + ' - MyCrochet') : 'Product - MyCrochet';
            }
            if (priceEl) priceEl.innerText = formatPrice(normalized.price);
            if (descEl) descEl.innerText = normalized.desc || ('This beautiful ' + (normalized.title || 'item') + ' is handcrafted with love using premium materials.');

            if (mainImgEl) {
                mainImgEl.src = (normalized.images && normalized.images[0]) ? normalized.images[0] : (normalized.mainImage || 'https://placehold.co/600x600?text=No+Image');
                mainImgEl.onerror = function() { this.src = 'https://placehold.co/600x600?text=No+Image'; };
            }

            // Thumbnails
            const thumbs = (normalized.images && normalized.images.length) ? normalized.images.slice(0, 6) : [mainImgEl.src];
            buildThumbnails(thumbs, 0);

            // Wire actions: Add & Buy
            const productForCart = {
                id: normalized.id,
                title: normalized.title,
                price: normalized.price,
                images: normalized.images,
                mainImage: normalized.mainImage
            };

            const addBtn = document.getElementById('addToBagBtn');
            const buyBtn = document.getElementById('buyNowBtn');
            if (addBtn) {
                addBtn.onclick = function () { addToCartAction(productForCart); };
            }
            if (buyBtn) {
                buyBtn.onclick = function () { buyNowAction(productForCart); };
            }

            // Ensure qty is at least 1
            const qtyInput = document.getElementById('qtyInput');
            if (qtyInput && (!qtyInput.value || Number(qtyInput.value) < 1)) qtyInput.value = '1';
        });
    </script>
</body>
</html>